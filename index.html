<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>เข้าสู่ระบบ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
  <h1>เข้าสู่ระบบ</h1>
  <div>วันนี้: <span id="today"></span> • เวลา: <span id="now"></span></div>

  <input id="empId" placeholder="รหัสพนักงาน">
  <button onclick="doLogin()">เข้าสู่ระบบ</button>
  <div id="msg"></div>

  <!-- โหลด common.js ก่อน -->
  <script src="common.js"></script>

  <!-- script หลัก -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // ตั้งวันที่/เวลา
      document.getElementById('today').textContent = todayLocal().display;
      setInterval(() => {
        document.getElementById('now').textContent = new Date().toLocaleTimeString();
      }, 1000);
    });

    function setMsg(ok, text){
      const el = document.getElementById('msg');
      el.style.color = ok ? 'green' : 'red';
      el.textContent = text;
    }

    async function doLogin(){
      setMsg(true, 'กำลังตรวจสอบ…');
      const id = (document.getElementById('empId').value||'').trim();
      if(!id){ setMsg(false, 'กรุณากรอกรหัส'); return; }
      try {
        const data = await postJSON(API.LOGIN, { employeeId: id });
        if(!data?.ok){ setMsg(false, data?.message || 'ไม่พบรหัส'); return; }
        setMsg(true, 'เข้าสู่ระบบสำเร็จ');
        setCurrentUser({ id, ...data });
      } catch(e) {
        setMsg(false, e.message||e);
      }
    }
  </script>
</body>
</html>
